import{_ as u,b as p,o as n,c as d,a as t,e as h,w as l,v as c,d as m}from"./index-C4bAc271.js";const w={name:"EmailVerification",data(){return{step:1,email:"",otp:"",newPassword:"",confirmPassword:"",validated:{password:!1,passwordConfirm:!1},step2:!1}},computed:{isValidated(){return this.validated.password&&this.validated.passwordConfirm}},watch:{newPassword(e){this.validatePassword(e)},confirmPassword(e){this.validatePasswordConfirm(e)}},methods:{async sendOtp(){var e,s;try{const r=await p.post("/auth/account/check",{email:this.email});this.$toast.success(r.data.message),this.step=2}catch(r){this.$toast.error(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Đã xảy ra lỗi. Vui lòng thử lại.")}},async verifyOtp(){var e,s;try{const r=await p.post("/auth/account/verify",{email:this.email,code:this.otp,type:"reset"});this.$toast.success(r.data.message),this.step=3}catch(r){this.$toast.error(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Mã OTP không hợp lệ.")}},async resetPassword(){var e,s;if(this.isValidated)try{const r=await p.post("/auth/account/resetpassword",{email:this.email,newPassword:this.newPassword});this.$toast.success(r.data.message),setTimeout(()=>{this.$router.replace("/login").then(()=>{window.location.reload()})},2e3)}catch(r){this.$toast.error(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Đã xảy ra lỗi khi đổi mật khẩu.")}},validatePassword(e){const s=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;this.validated.password=s.test(e)},validatePasswordConfirm(e){this.validated.passwordConfirm=e===this.newPassword}}},f={class:"email-verification bg-light"},b={class:"d-flex justify-content-center align-items-center vh-100"},v={class:"bg-white p-4 border border-dark"},y=t("h1",{class:"text-dark text-center mb-4"},"Thay đổi mật khẩu",-1),_={class:"mb-3"},P=t("label",{for:"email",class:"form-label"},"Nhập vào Email",-1),g=t("button",{type:"submit",class:"btn btn-primary"},"Gửi Mã OTP",-1),k={class:"mb-3"},M=t("label",{for:"otp",class:"form-label"},"Nhập Mã OTP",-1),x={key:0,class:"info"},O=t("button",{type:"submit",class:"btn btn-primary"},"Xác Thực Mã OTP",-1),V={class:"mb-3"},T=t("label",{for:"newPassword",class:"form-label"},"Nhập Mật Khẩu Mới",-1),C={key:0,class:"text-danger mt-1"},N={class:"mb-3"},q=t("label",{for:"confirmPassword",class:"form-label"},"Xác Nhận Mật Khẩu Mới",-1),U={key:0,class:"text-danger mt-1"},B=["disabled"];function E(e,s,r,K,o,i){return n(),d("div",f,[t("div",b,[t("div",v,[y,o.step===1?(n(),d("form",{key:0,onSubmit:s[1]||(s[1]=h((...a)=>i.sendOtp&&i.sendOtp(...a),["prevent"]))},[t("div",_,[P,l(t("input",{type:"email","onUpdate:modelValue":s[0]||(s[0]=a=>o.email=a),class:"form-control",required:""},null,512),[[c,o.email]])]),g],32)):o.step===2?(n(),d("form",{key:1,onSubmit:s[3]||(s[3]=h((...a)=>i.verifyOtp&&i.verifyOtp(...a),["prevent"]))},[t("div",k,[M,l(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>o.otp=a),class:"form-control",required:""},null,512),[[c,o.otp]])]),o.step2?(n(),d("p",x,"Mã OTP đã được gửi đến email của bạn.")):m("",!0),O],32)):o.step===3?(n(),d("form",{key:2,onSubmit:s[6]||(s[6]=h((...a)=>i.resetPassword&&i.resetPassword(...a),["prevent"]))},[t("div",V,[T,l(t("input",{type:"password","onUpdate:modelValue":s[4]||(s[4]=a=>o.newPassword=a),class:"form-control",required:""},null,512),[[c,o.newPassword]]),o.validated.password?m("",!0):(n(),d("p",C," Mật khẩu phải gồm ít nhất 8 kí tự bao gồm chữ thường/HOA và 1 số. "))]),t("div",N,[q,l(t("input",{type:"password","onUpdate:modelValue":s[5]||(s[5]=a=>o.confirmPassword=a),class:"form-control",required:""},null,512),[[c,o.confirmPassword]]),o.validated.passwordConfirm?m("",!0):(n(),d("p",U," Vui lòng nhập đúng lại mật khẩu đã nhập. "))]),t("button",{type:"submit",class:"btn btn-primary",disabled:!i.isValidated}," Đổi Mật Khẩu ",8,B)],32)):m("",!0)])])])}const A=u(w,[["render",E]]);export{A as default};
