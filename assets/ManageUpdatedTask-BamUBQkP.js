import{_ as C,b as i,o as d,c,a as s,F as k,k as g,n as p,t as l,w as _,v as E,p as y,l as T}from"./index-DJbuJOQH.js";const f={data(){return{updates:[],loading:!0}},created(){this.fetchTaskUpdates()},methods:{async fetchTaskUpdates(){var t,e;this.loading=!0;try{const r=await i.get("/admin/task/update-request/all");this.updates=r.data.data.map(u=>({...u,adminComment:u.adminComment||""}))}catch(r){this.$toast.error(((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||r.message)}finally{this.loading=!1}},formatDate(t){const e={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Bangkok",hour12:!1};return new Date(t).toLocaleString("vi-VN",e)},toTaskInfo(t){this.$router.replace({name:"TaskDetail",params:{taskId:t}})},translateStatus(t){return{PENDING:"Đang chờ",IN_PROGRESS:"Đang tiến hành",COMPLETED:"Đã hoàn thành",CANCELED:"Hủy",APPROVED:"Đã chấp thuận",REJECTED:"Đã từ chối"}[t]||t},getRowClass(t){return t.status==="APPROVED"?"table-success":t.status==="REJECTED"?"table-danger":""},async approveRequest(t){var e,r;if(confirm("Bạn có chắc chắn muốn phê duyệt yêu cầu này?")){const u={requestId:t.id,taskId:t.task.id,requestStatus:t.requestedStatus,status:"APPROVED",adminComment:t.adminComment};try{const n=await i.put("/admin/task/update-request/approve",u);t.adminComment.trim()!==""&&await this.postComment(t),this.$toast.success(n.data.message),await this.fetchTaskUpdates()}catch(n){this.$toast.error(((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||n.message)}}},async rejectRequest(t){var e,r;if(confirm("Bạn có chắc chắn muốn từ chối yêu cầu này?")){const u={requestId:t.id,taskId:t.task.id,requestStatus:t.requestedStatus,status:"REJECTED",adminComment:t.adminComment};try{const n=await i.put("/admin/task/update-request/reject",u);this.$toast.success(n.data.message),await this.fetchTaskUpdates(),t.adminComment.trim()!==""&&await this.postComment(t)}catch(n){this.$toast.error(((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||n.message)}}},async postComment(t){try{const e=await i.post(`/comment/task/${t.task.id}`,{content:t.adminComment,userId:this.userId})}catch{}}},computed:{userId(){return this.$authStore.userId}}},m=t=>(y("data-v-523eb881"),t=t(),T(),t),D=m(()=>s("h2",null,"Danh Sách Yêu Cầu Cập Nhật Tác Vụ",-1)),b={key:0},R={key:1,class:"table table-bordered"},S=m(()=>s("thead",null,[s("tr",{class:"table-dark",style:{color:"aliceblue"}},[s("th",null,"Tác vụ"),s("th",null,"Trạng thái tác vụ"),s("th",null,"Ngày Yêu Cầu Cập Nhật"),s("th",null,"Trạng Thái Yêu Cầu Cập Nhật"),s("th",null,"Mô Tả Cập Nhật"),s("th",null,"Trạng Thái Xét Duyệt"),s("th",null,"Nhận Xét Quản trị viên"),s("th",null,"Phê Duyệt"),s("th",null,"Từ Chối")])],-1)),q=["onClick"],v={class:"task-title",title:"Xem tác vụ"},I={key:0},P=["onUpdate:modelValue"],w=["onClick","disabled"],N=["onClick","disabled"];function V(t,e,r,u,n,o){return d(),c("div",null,[D,n.loading?(d(),c("div",b,"Đang tải dữ liệu...")):(d(),c("table",R,[S,s("tbody",null,[(d(!0),c(k,null,g(n.updates,a=>(d(),c("tr",{key:a.id,class:p(o.getRowClass(a))},[s("td",{onClick:h=>o.toTaskInfo(a.task.id)},[s("a",v,l(a.task.title),1)],8,q),s("td",null,l(o.translateStatus(a.task.status)),1),s("td",null,l(o.formatDate(a.requestedDate)),1),s("td",{class:p({underline:a.requestedStatus!==a.task.status})},l(o.translateStatus(a.requestedStatus)),3),s("td",null,l(a.description||"Không có mô tả"),1),s("td",null,l(o.translateStatus(a.status)),1),s("td",null,[a.status==="APPROVED"||a.status==="REJECTED"?(d(),c("p",I,l(a.adminComment||"Không có nhận xét"),1)):_((d(),c("input",{key:1,"onUpdate:modelValue":h=>a.adminComment=h,type:"text",class:"form-control",placeholder:"Nhập nhận xét"},null,8,P)),[[E,a.adminComment]])]),s("td",null,[s("button",{onClick:h=>o.approveRequest(a),class:"btn btn-success btn-sm",disabled:a.status==="APPROVED"||a.status==="REJECTED"}," Phê Duyệt ",8,w)]),s("td",null,[s("button",{onClick:h=>o.rejectRequest(a),class:"btn btn-danger btn-sm",disabled:a.status==="APPROVED"||a.status==="REJECTED"}," Từ Chối ",8,N)])],2))),128))])]))])}const O=C(f,[["render",V],["__scopeId","data-v-523eb881"]]);export{O as default};
