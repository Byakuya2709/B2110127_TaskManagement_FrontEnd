import{_ as p,b as u,o as l,c as m,a as t,t as d,i as k,n as b,w as _,v as C,F as f,k as y,d as g,p as I,l as v}from"./index-C4bAc271.js";const w={name:"TaskDetail",data(){return{task:{},comments:[],newComment:"",editingCommentId:null,editCommentContent:""}},created(){this.fetchTask(),this.fetchComments()},methods:{async fetchTask(){var s,e;try{const r=await u.get(`/admin/task/${this.$route.params.taskId}`);this.task=r.data.data}catch(r){console.error(r),this.$toast.error(((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||"An unexpected error occurred.")}},async fetchComments(){try{const s=await u.get(`/comment/task/${this.$route.params.taskId}`);this.comments=s.data.data.map(e=>({id:e.id,content:e.content,date:e.createdDate,userId:e.userId,userName:e.userName,taskTitle:e.taskTitle,taskId:e.taskId}))}catch(s){console.error(s),this.$toast.error("Failed to load comments.")}},async postComment(){var s,e;if(this.newComment.trim())try{const r=await u.post(`/comment/task/${this.$route.params.taskId}`,{content:this.newComment,userId:this.userId}),o=r.data.data;this.comments.push({id:o.id,content:o.content,date:o.createdDate,userName:o.userName,userId:o.userId,taskId:o.taskId}),this.newComment="",this.$toast.success(r.data.message)}catch(r){const o=((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||r;this.$toast.error(o)}},async deleteComment(s){var e,r;try{await u.delete(`/comment/task/${s}`),this.comments=this.comments.filter(o=>o.id!==s),this.$toast.success("Bình luận đã được xóa thành công.")}catch(o){const n=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||o;this.$toast.error(n)}},enableCommentEdit(s){this.editingCommentId=s.id,this.editCommentContent=s.content},async saveCommentEdit(s){var e,r;try{console.log(this.editCommentContent),await u.put(`/comment/task/${s}`,{content:this.editCommentContent});const o=this.comments.find(n=>n.id===s);o&&(o.content=this.editCommentContent),this.editingCommentId=null,this.editCommentContent="",this.$toast.success("Bình luận đã được cập nhật.")}catch(o){const n=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||o;this.$toast.error(n)}},cancelCommentEdit(){this.editingCommentId=null,this.editCommentContent=""},async updateTask(){this.$router.push({name:"EditTask",params:{id:this.task.id}})},async deleteTask(){if(confirm("Are you sure you want to delete this task?"))try{await u.delete(`/admin/task/${this.task.id}`),this.$toast.success("Task deleted successfully!"),this.$router.replace({name:"Tasks"})}catch(e){console.log(e),this.$toast.error(e.response.data.message)}},formatDate(s){return new Date(s).toLocaleDateString()},formatDateTime(s){return new Date(s).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},taskBadges(s){return{"badge-success":s==="COMPLETED","badge-warning":s==="PENDING","badge-danger":s==="CANCELED","badge-info":s==="IN_PROGRESS"}}},computed:{userId(){return this.$authStore.userId},role(){return this.$authStore.role}}},c=s=>(I("data-v-ffe2274a"),s=s(),v(),s),D={class:"card task-card"},x={class:"card-body"},T={class:"button-group"},N={class:"card-title task-title"},E=c(()=>t("hr",null,null,-1)),S={class:"card-text task-description"},L=c(()=>t("hr",null,null,-1)),B={class:"container task-details"},V={class:"row"},A={class:"col-6 text-right"},F=c(()=>t("strong",null,"Ngày tạo công việc:",-1)),G={class:"col-6 text-right"},M=c(()=>t("strong",null,"Ngày hoàn thành:",-1)),O={class:"col-6 text-right"},P=c(()=>t("strong",null,"Lần cuối cập nhật:",-1)),R={class:"col-6 text-left"},U=c(()=>t("strong",null,"Chịu trách nhiệm:",-1)),X={class:"row mt-3"},z={class:"col-12 text-center"},H=c(()=>t("hr",null,null,-1)),j={class:"comment-form"},q=c(()=>t("h5",null,"Đăng bình luận",-1)),J=c(()=>t("hr",null,null,-1)),K={class:"comments-section"},Q=c(()=>t("h5",null,"Nhận xét",-1)),W={key:0},Y={key:0},Z=["onClick"],$={key:1},tt={class:"text-muted"},et=["onClick"],st=["onClick"];function nt(s,e,r,o,n,i){return l(),m("div",D,[t("div",x,[t("div",T,[t("button",{class:"btn btn-warning mx-2",onClick:e[0]||(e[0]=(...a)=>i.updateTask&&i.updateTask(...a))}," Cập nhật "),t("button",{class:"btn btn-danger",onClick:e[1]||(e[1]=(...a)=>i.deleteTask&&i.deleteTask(...a))},"Xóa")]),t("h5",N,d(n.task.title),1),E,t("p",S,d(n.task.description),1),L,t("div",B,[t("div",V,[t("div",A,[F,k(" "+d(i.formatDate(n.task.createdDate)),1)]),t("div",G,[M,k(" "+d(i.formatDate(n.task.date)),1)]),t("div",O,[P,k(" "+d(i.formatDate(n.task.updatedDate)),1)]),t("div",R,[U,k(" "+d(n.task.userName),1)])]),t("div",X,[t("div",z,[t("span",{class:b(["badge",i.taskBadges(n.task.status)])},d(n.task.status),3)])])]),H,t("div",j,[q,_(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>n.newComment=a),class:"form-control",placeholder:"Nhập bình luận của bạn..."},null,512),[[C,n.newComment]]),t("button",{class:"btn btn-primary mt-2",onClick:e[3]||(e[3]=(...a)=>i.postComment&&i.postComment(...a))},"Gửi")]),J,t("div",K,[Q,n.comments.length===0?(l(),m("p",W,"Chưa có nhận xét.")):(l(!0),m(f,{key:1},y(n.comments,a=>(l(),m("div",{key:a.id,class:"comment d-flex align-items-center"},[n.editingCommentId===a.id?(l(),m("div",Y,[_(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=h=>n.editCommentContent=h),class:"form-control mb-2",placeholder:"Sửa bình luận..."},null,512),[[C,n.editCommentContent]]),t("button",{class:"btn btn-success btn-sm mr-2",onClick:h=>i.saveCommentEdit(a.id)}," Lưu ",8,Z),t("button",{class:"btn btn-secondary btn-sm",onClick:e[5]||(e[5]=(...h)=>i.cancelCommentEdit&&i.cancelCommentEdit(...h))}," Hủy ")])):(l(),m("div",$,[t("p",null,[t("strong",null,d(a.userName)+":",1),k(" "+d(a.content),1)]),t("p",tt,d(i.formatDateTime(a.date)),1)])),t("div",null,[a.userId===i.userId||this.role=="ROLE_ADMIN"?(l(),m("button",{key:0,class:"btn btn-danger btn-sm ml-auto",onClick:h=>i.deleteComment(a.id)}," Xóa ",8,et)):g("",!0),a.userId===i.userId&&n.editingCommentId!==a.id?(l(),m("button",{key:1,class:"btn btn-info btn-sm ml-2",onClick:h=>i.enableCommentEdit(a)}," Sửa ",8,st)):g("",!0)])]))),128))])])])}const at=p(w,[["render",nt],["__scopeId","data-v-ffe2274a"]]);export{at as default};
