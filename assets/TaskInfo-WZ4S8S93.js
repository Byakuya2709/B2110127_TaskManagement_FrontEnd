import{_ as b,b as u,o as l,c as m,a as t,t as d,i as _,n as p,w as C,v as k,F as I,k as f,d as g,p as v,l as y}from"./index-C4bAc271.js";const w={name:"TaskDetail",data(){return{task:{},comments:[],newComment:"",editingCommentId:null,editCommentContent:""}},created(){this.fetchTask(),this.fetchComments()},methods:{async fetchTask(){var e,s;try{const a=await u.get(`/user/task/${this.$route.params.taskId}`);this.task=a.data.data}catch(a){console.error(a),this.$toast.error(((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"An unexpected error occurred.")}},async fetchComments(){try{const e=await u.get(`/comment/task/${this.$route.params.taskId}`);this.comments=e.data.data.map(s=>({id:s.id,content:s.content,date:s.createdDate,userId:s.userId,userName:s.userName,taskTitle:s.taskTitle,taskId:s.taskId}))}catch(e){console.error(e),this.$toast.error("Failed to load comments.")}},async postComment(){var e,s;if(this.newComment.trim())try{const a=await u.post(`/comment/task/${this.$route.params.taskId}`,{content:this.newComment,userId:this.userId}),o=a.data.data;this.comments.push({id:o.id,content:o.content,date:o.createdDate,userName:o.userName,userId:o.userId,taskId:o.taskId}),this.newComment="",this.$toast.success(a.data.message)}catch(a){const o=((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||a;this.$toast.error(o)}},async deleteComment(e){var s,a;try{await u.delete(`/comment/task/${e}`),this.comments=this.comments.filter(o=>o.id!==e),this.$toast.success("Bình luận đã được xóa thành công.")}catch(o){const n=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.message)||o;this.$toast.error(n)}},enableCommentEdit(e){this.editingCommentId=e.id,this.editCommentContent=e.content},async saveCommentEdit(e){var s,a;try{console.log(this.editCommentContent),await u.put(`/comment/task/${e}`,{content:this.editCommentContent});const o=this.comments.find(n=>n.id===e);o&&(o.content=this.editCommentContent),this.editingCommentId=null,this.editCommentContent="",this.$toast.success("Bình luận đã được cập nhật.")}catch(o){const n=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.message)||o;this.$toast.error(n)}},async updateTask(){this.$router.push({name:"UpdateTaskByUser",params:{id:this.task.id}})},cancelCommentEdit(){this.editingCommentId=null,this.editCommentContent=""},formatDate(e){return new Date(e).toLocaleDateString()},formatDateTime(e){return new Date(e).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},taskBadges(e){return{"badge-success":e==="COMPLETED","badge-warning":e==="PENDING","badge-danger":e==="CANCELED","badge-info":e==="IN_PROGRESS"}}},computed:{userId(){return this.$authStore.userId},role(){return this.$authStore.role}}},c=e=>(v("data-v-c6b5e0fb"),e=e(),y(),e),D={class:"card task-card"},x={class:"card-body"},N={class:"button-group"},E=["disabled"],T={class:"card-title task-title"},S=c(()=>t("hr",null,null,-1)),L={class:"card-text task-description"},B=c(()=>t("hr",null,null,-1)),V={class:"container task-details"},G={class:"row"},M={class:"col-6 text-right"},O=c(()=>t("strong",null,"Ngày tạo công việc:",-1)),P={class:"col-6 text-right"},U=c(()=>t("strong",null,"Ngày hoàn thành:",-1)),A={class:"col-6 text-right"},F=c(()=>t("strong",null,"Lần cuối cập nhật:",-1)),R={class:"col-6 text-left"},z=c(()=>t("strong",null,"Chịu trách nhiệm:",-1)),H={class:"row mt-3"},X={class:"col-12 text-center"},j=c(()=>t("hr",null,null,-1)),q={class:"comment-form"},J=c(()=>t("h5",null,"Đăng bình luận",-1)),K=c(()=>t("hr",null,null,-1)),Q={class:"comments-section"},W=c(()=>t("h5",null,"Nhận xét",-1)),Y={key:0},Z={key:0},$=["onClick"],tt={key:1},et={class:"text-muted"},st=["onClick"],nt=["onClick"];function ot(e,s,a,o,n,r){return l(),m("div",D,[t("div",x,[t("div",N,[t("button",{disabled:n.task.status==="COMPLETED"||this.userId!=n.task.userId,class:"btn btn-warning mx-2",onClick:s[0]||(s[0]=(...i)=>r.updateTask&&r.updateTask(...i))}," Gửi yêu cầu Cập nhật ",8,E)]),t("h5",T,d(n.task.title),1),S,t("p",L,d(n.task.description),1),B,t("div",V,[t("div",G,[t("div",M,[O,_(" "+d(r.formatDate(n.task.createdDate)),1)]),t("div",P,[U,_(" "+d(r.formatDate(n.task.date)),1)]),t("div",A,[F,_(" "+d(r.formatDate(n.task.updatedDate)),1)]),t("div",R,[z,_(" "+d(n.task.userName),1)])]),t("div",H,[t("div",X,[t("span",{class:p(["badge",r.taskBadges(n.task.status)])},d(n.task.status),3)])])]),j,t("div",q,[J,C(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=i=>n.newComment=i),class:"form-control",placeholder:"Nhập bình luận của bạn..."},null,512),[[k,n.newComment]]),t("button",{class:"btn btn-primary mt-2",onClick:s[2]||(s[2]=(...i)=>r.postComment&&r.postComment(...i))},"Gửi")]),K,t("div",Q,[W,n.comments.length===0?(l(),m("p",Y,"Chưa có nhận xét.")):(l(!0),m(I,{key:1},f(n.comments,i=>(l(),m("div",{key:i.id,class:"comment d-flex align-items-center"},[n.editingCommentId===i.id?(l(),m("div",Z,[C(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=h=>n.editCommentContent=h),class:"form-control mb-2",placeholder:"Sửa bình luận..."},null,512),[[k,n.editCommentContent]]),t("button",{class:"btn btn-success btn-sm mr-2",onClick:h=>r.saveCommentEdit(i.id)}," Lưu ",8,$),t("button",{class:"btn btn-secondary btn-sm",onClick:s[4]||(s[4]=(...h)=>r.cancelCommentEdit&&r.cancelCommentEdit(...h))}," Hủy ")])):(l(),m("div",tt,[t("p",null,[t("strong",null,d(i.userName)+":",1),_(" "+d(i.content),1)]),t("p",et,d(r.formatDateTime(i.date)),1)])),t("div",null,[i.userId===r.userId&&n.editingCommentId!==i.id?(l(),m("button",{key:0,class:"btn btn-info btn-sm ml-2",onClick:h=>r.enableCommentEdit(i)}," Sửa ",8,st)):g("",!0),i.userId===r.userId||this.role=="ROLE_ADMIN"?(l(),m("button",{key:1,class:"btn btn-danger btn-sm ml-auto",onClick:h=>r.deleteComment(i.id)}," Xóa ",8,nt)):g("",!0)])]))),128))])])])}const it=b(w,[["render",ot],["__scopeId","data-v-c6b5e0fb"]]);export{it as default};
